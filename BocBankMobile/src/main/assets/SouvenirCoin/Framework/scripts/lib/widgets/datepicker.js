/*! BUILD: 2016-12-16 */
define("DatepickerWidget",["zepto"],function(a){function b(b){return a.isTmplContainsCtrl(b,"DatepickerWidget")?(a(b).find(".datepicker_widget").each(function(d,e){return a(e).attr("binded")?b:(c(e),void a(e).attr("binded","true"))}),b):b}function c(b){function c(c){var d=b.find(".datepicker_sel_container").offset().top;a(c).children().removeClass("selected").each(function(c,e){if(Math.abs(a(e).offset().top-d-g*h)<=10){a(e).addClass("selected");var f=a(e).parent().parent()[0],i=a(e).text();-1!=f.className.indexOf("year_container")?b.find(".selected_year").text(i):-1!=f.className.indexOf("month_container")?b.find(".selected_month").text(i):b.find(".selected_date").text(i)}})}function d(c,d){b.find(c).each(function(b,c){a(c).text()==d&&(a(c).parent().attr("old_dis",(g-b)*h),a(c).parent().css("-webkit-transform","translateY("+(g-b)*h+"px)"))})}function e(b){var c=a(b.target).val();c||(c=a(b.target).parent().attr("default")||new Date),"string"==typeof c?c=new Date(c):"",d(".year_container .select_table-view-cell",c.getFullYear()),d(".month_container .select_table-view-cell",c.getMonth()+1),d(".date_container .select_table-view-cell",c.getDate())}b=a(b),"year-month"==b.attr("date_mode")&&(b.find(".datepicker_sel_container").addClass("datepicker_yearmonth_container"),b.find(".selected_date_area .selected_date, .selected_date_area .date_separator").empty());var f,g,h=32;b.find(".select_table-view").on("touchstart mousedown",function(b){var c=b.touches&&b.touches[0]||a(b.target),d={x:c.pageX||b.pageX,y:c.pageY||b.pageY},e=a(b.target).parent();e.attr("scrolling","true"),e.attr("x",d.x).attr("y",d.y),b.stopPropagation()}).on("touchmove mousemove",function(b){b.preventDefault();var d=b.touches&&b.touches[0]||a(b.target),e={x:d.pageX||b.pageX,y:d.pageY||b.pageY},i=a(b.target).parent();if("true"!==i.attr("scrolling"))return!1;var j=Math.abs(e.x-i.attr("x")),k=Math.abs(e.y-i.attr("y")),l=e.y-i.attr("y")>0?1:-1,m=1*i.attr("old_dis"),n=m+Math.ceil(k/h)*h*l;n=n>0?g*h>n?n:g*h:Math.abs(n)+f>i.height()+(Math.ceil(f/h)-g-1)*h?f-(i.height()+(Math.ceil(f/h)-g-1)*h):n,n=Math.ceil(n/h)*h,k>j&&k>20&&(i.attr("x",e.x).attr("y",e.y),i.attr("old_dis",n),i.css("-webkit-transform","translateY("+n+"px)"),b.stopPropagation(),c(i))}).on("touchend mouseup",function(b){b.preventDefault();var c=a(b.target).parent();c.attr("scrolling","false")}).on("wheel",function(b){var d=h,e=b.wheelDeltaY>0?1:-1,i=a(b.currentTarget),j=1*i.attr("old_dis"),k=j+Math.ceil(d/h)*h*e;k=k>0?g*h>k?k:g*h:Math.abs(k)+f>i.height()+(Math.round(f/h)-g-1)*h?f-(i.height()+(Math.round(f/h)-g-1)*h):k,i.attr("old_dis",k),i.css("-webkit-transform","translateY("+k+"px)"),b.stopPropagation(),c(i)}),b.find(".choosedatebtn").on("touchstart click",function(b){var c=a(b.target),d=c.parent().parent().parent().find("input"),e=c.siblings("span");d.val(e.text().replace(/\s/g,"")),a(".datepicker_widget .popup_widget, .datepicker_widget .selectoverlay").hide()}),b.find("input").on("touchstart click",function(a){a.stopPropagation(),b.find(".selectoverlay, .date_picker_container").show(),f=b.find(".datepicker_sel_container").height(),g=Math.ceil(Math.round(f/h)/2)-1,e(a),b.find(".datepicker_sel_container .select_table-view").each(function(a,b){c(b)})})}a._widget_renders=a._widget_renders||{};var d=function(b){var c=a.analyzeWidgetProperties(b),d=new EJS({url:"views/wgt_tmpl/datepicker.ejs"}).render({classes:c.classes,style:c.style,id:c.id,name:c.name,disabled:c.disabled,required:c.required,validator:c.validator,regExp:c.regExp,value:c.value,minyear:c.minyear||1900,maxyear:c.maxyear||2030,date_mode:c.date_mode},!0);return d};a._widget_renders.DatepickerWidget=d,a.funAop(a.fn,{html:{after:function(a){return b(a)}},append:{after:function(a){return b(a)}}},!0),a.extend(a.fn,{bindAsDatePicker:function(b){{var d=a(this);d.parent()}b=a.extend(a.analyzeWidgetProperties(d[0].outerHTML),b);var e=new EJS({url:"views/wgt_tmpl/datepicker.ejs"}).render({classes:b.classes||"",style:b.style||"",id:b.id||"",name:b.name||"",disabled:b.disabled||"",required:b.required||!1,validator:b.validator||"",regExp:b.regExp||"",value:b.value||"",minyear:b.minyear||1900,maxyear:b.maxyear||2030,date_mode:b.date_mode},!0),f=a(e).insertBefore(d);return d.remove(),c(f),f}})});