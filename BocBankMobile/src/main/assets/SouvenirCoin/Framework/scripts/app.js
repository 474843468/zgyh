/*! BUILD: 2016-12-16 */
"use strict";require(["./appconfig"],function(a){require.config(a),window.localStorage&&window.localStorage.clear();var b=function(){var a=window.location.search;if(!a)return{};if(a+=window.location.hash,a.indexOf("?")>-1&&(a=a.substring(1)),""==a)return{};a='{"'+decodeURIComponent(a.replace(/[&#?]/g,'","').replace(/=/g,'":"').replace(/,[^,:]*,/g,",").replace(/\",[^,:]*$/,""))+'"}';var b=JSON.parse(a);return b}(),c=(b._locale?b._locale:"zh-CN"==navigator.language?"zh_cn":"en_us").toLowerCase();require(["zepto","common","model","routesUtil","nls_public_"+c,"stackCtrl"],function(b,c,d,e,f,g){var h=arguments,i=b.extendCls({_constructor:function(){this.loaded=!1,this.nls=f,this.onError(),this.urlParams=c.urlParams,this.parseRoute(),this.loaded=!0,this.load();var a={after:function(a,d){return d&&d[1]||c.changeLanguage(b.lastInserts()),a}};b.funAop(b.fn,{html:a,append:a})},load:function(){var a=this;require(["domReady","ejs"],function(d){d(function(){if(a.vStack=new g(".stacks"),c.terminal.ios){b("html").addClass("ios"),a.routeToModule();try{a.addIOS7Flag()}catch(d){}}else c.terminal.android,a.routeToModule()})})},parseRoute:function(){var a,b=this.urlParams,d=c.params;if(this.shareFlag=!1,this.routerPath="",!b||!b.entrance)throw new Error("Application address configuration errors, you must have an 'entrance' parameter");if(a=b.entrance,d.openId=b.openid||"",d.pubid=b.pubid||"",d.Code=b.code||"",d.appid=b.appid||"",this.routerPath=c.getRouterPath(a),"undefined"==typeof this.routerPath)throw new Error("Router key '"+a+"' is not defined");d.targetRouter.entryRouterKey=a||"",d.targetRouter.excuteFun=b.shareFun||"",d.targetRouter.funArgs=b.shareArgs||"",d.targetRouter.funArgs=d.targetRouter.funArgs.replace(/\[|\]/g,"").split("_"),d.targetRouter.routerKey=b.target||b.sharekey||b.shareKey||"",(b.sharekey||b.shareKey)&&(this.shareFlag=!0,d.targetRouter.shareFlag=!0)},routeToModule:function(){var a=this;c.Router(a.routerPath,a.shareFlag)},onError:function(){require(["common"],function(a){require.onError=function(c){throw"timeout"===c.requireType&&(b("#maskbox").remove(),a.showAlert("当前访问人数过多，请点击确定重试",["确定"],function(){window.location.reload()})),c}}),window.onerror=function(a,b,d,e,f){c.log.error(a,f&&f.stack||"")}},addIOS7Flag:function(){var a=navigator.userAgent.toLowerCase(),c="";if(a.indexOf("like mac os x")>0){var d=/os [\d._]*/gi,e=a.match(d);c=(e+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")}var f=c+"";"undefined"!=f&&f.length>0&&(c=f.substring(0,3),7.1>=c&&b("html").addClass("ios7"))}});b.funAop(i,{_constructor:{before:function(){a.onAppInitBefore&&a.onAppInitBefore.apply(window.app,h)},after:function(){a.onAppInitAfter&&a.onAppInitAfter.apply(window.app,h)}},routeToModule:{before:function(){a.onRouteBefore&&a.onRouteBefore.apply(window.app,h)},after:function(){a.onRouteAfter&&a.onRouteAfter.apply(window.app,h)}}}),window.app=new i,c.changeLanguage("body")})});